<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Indicadores</title>
    <style>
        body {
            background-color: aliceblue !important;
        }
    </style>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/alasql@0.7.0/dist/alasql.min.js"></script>
    <script>
        let jsonData = [];
        let mttoChart, mttpmChart, mttqeChart, availabilityChart, equipamentosGerais, chartTaxaDisponibilidadePercentual, ChartfalhasAtivas, db;

        async function loadData() {
            const apiKey = 'AIzaSyBSSxNV1h0oggNmh7FOlSUExFJHJGb4hOY';
            const spreadsheetId = '19h5tX7GVEhgpcZRxnQhc4_2gDt5ucZS4SRO-PT7g88Q';
            const range = 'Base De Dados!A1:Z1000000';

            const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`);
            const data = await response.json();

            const headers = data.values[0];
            jsonData = data.values.slice(1).map(row => {
                let obj = {};
                row.forEach((cell, index) => {
                    obj[headers[index]] = cell;
                });
                return obj;
            });

            alasql('CREATE TABLE eventos (CodEvento INT, DscEvento STRING, Equipamento STRING, FimEvento DATE, InicioEvento DATE)');
            alasql('INSERT INTO eventos SELECT * FROM ?', [jsonData]);

            console.log(alasql('SELECT * FROM eventos'));
            console.log(alasql('SELECT * FROM eventos ORDER BY InicioEvento DESC'));

            renderDashboard(jsonData);
        }

        function renderDashboard(data) {
            renderEquipmentSelection(data);

            renderMetrics(0, "", "", false);
        }

        function sortEquipmentTypes(types) {
            types.sort((a, b) => {
                const numA = parseInt(a.substring(1));
                const numB = parseInt(b.substring(1));

                if (numA < numB) return -1;
                if (numA > numB) return 1;
                return 0;
            });

            return types;
        }

        function renderEquipmentSelection(data) {
            var equipmentTypes = [...new Set(data.map(item => item.Equipamento))];
            equipmentTypes = sortEquipmentTypes(equipmentTypes);

            const selectEquipment = document.getElementById('selectEquipment');

            const allOption = document.createElement('option');
            allOption.textContent = 'Total';
            allOption.value = '0';
            selectEquipment.appendChild(allOption);

            equipmentTypes.forEach(equipment => {
                const option = document.createElement('option');
                option.textContent = equipment;
                option.value = equipment;
                selectEquipment.appendChild(option);
            });

        }

        function renderMetrics(data, data1, data2, temData) {
            console.log(data);
            renderTotalEquipment(data);
            renderNumberBreakdowns(data, data1, data2, temData);
            renderNumberPreventiveMaintenances(data, data1, data2, temData);
            renderChartMTTO(data, data1, data2, temData);
            renderChartMTTMP(data, data1, data2, temData);
            renderChartMTTQE(data, data1, data2, temData);
        
            renderChartTaxaDisponibilidade(data, data1, data2, temData);
            renderChartFailurePerDays(data, data1, data2, temData);
            renderFalhasAtivas(data, data1, data2, temData);
            return
        }

        function destroyCharts() {
            if (mttoChart) {
                mttoChart.destroy();
            }
            if (mttpmChart) {
                mttpmChart.destroy();
            }
            if (mttqeChart) {
                mttqeChart.destroy();
            }
            if (availabilityChart) {
                availabilityChart.destroy();
            }
            if (chartTaxaDisponibilidadePercentual) {
                chartTaxaDisponibilidadePercentual.destroy();
            }
            if (ChartfalhasAtivas) {
                ChartfalhasAtivas.destroy();
            }
        }

        function renderChartMTTO(data, formattedStartDate, formattedEndDate, temData) {
            const ctxMTTO = document.getElementById('chartMTTO').getContext('2d');
            var equipmentTypes = data == 0 ? alasql('SELECT DISTINCT Equipamento FROM eventos ORDER BY Equipamento;') 
            : alasql(`SELECT DISTINCT Equipamento FROM eventos where Equipamento == '${data}' ORDER BY Equipamento;`)
            let equipamentos = equipmentTypes.map(item => item.Equipamento);
            var mediaMTTO;
            let temposMTTO;
            if(!temData){
                mediaMTTO = data == 0 ? alasql("SELECT Equipamento, AVG(DATEDIFF(HOUR, InicioEvento, FimEvento)) AS MTTO FROM eventos WHERE CodEvento = '264' GROUP BY Equipamento ORDER BY Equipamento ;") :
                    alasql(`SELECT Equipamento, AVG(DATEDIFF(HOUR, InicioEvento, FimEvento)) AS MTTO FROM eventos WHERE CodEvento = '264' AND Equipamento == '${data}' GROUP BY Equipamento ORDER BY Equipamento ;`);
                temposMTTO = mediaMTTO.map(item => item.MTTO);
            }else{
                mediaMTTO = data == 0 ? alasql(`SELECT Equipamento, AVG(DATEDIFF(HOUR, InicioEvento, FimEvento)) AS MTTO
                 FROM eventos WHERE CodEvento = '264' AND
                  DATE(CONVERT(datetime, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2) + ' ' + SUBSTRING(InicioEvento, 12, 8))) >= DATE(CONVERT(datetime, SUBSTRING('${formattedStartDate}', 7, 4) + '-' + SUBSTRING('${formattedStartDate}', 4, 2) + '-' + SUBSTRING('${formattedStartDate}', 1, 2) + ' ' + SUBSTRING('${formattedStartDate}', 12, 8)))
                AND DATE(CONVERT(datetime, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2) + ' ' + SUBSTRING(FimEvento, 12, 8))) <= DATE(CONVERT(datetime, SUBSTRING('${formattedEndDate}', 7, 4) + '-' + SUBSTRING('${formattedEndDate}', 4, 2) + '-' + SUBSTRING('${formattedEndDate}', 1, 2) + ' ' + SUBSTRING('${formattedEndDate}', 12, 8)))
                 GROUP BY Equipamento ORDER BY Equipamento ;`) :
                    alasql(`SELECT Equipamento, AVG(DATEDIFF(HOUR, InicioEvento, FimEvento)) AS MTTO 
                    FROM eventos 
                    WHERE CodEvento = '264' AND Equipamento == '${data}'
                    AND DATE(CONVERT(datetime, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2) + ' ' + SUBSTRING(InicioEvento, 12, 8))) >= DATE(CONVERT(datetime, SUBSTRING('${formattedStartDate}', 7, 4) + '-' + SUBSTRING('${formattedStartDate}', 4, 2) + '-' + SUBSTRING('${formattedStartDate}', 1, 2) + ' ' + SUBSTRING('${formattedStartDate}', 12, 8)))
                    AND DATE(CONVERT(datetime, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2) + ' ' + SUBSTRING(FimEvento, 12, 8))) <= DATE(CONVERT(datetime, SUBSTRING('${formattedEndDate}', 7, 4) + '-' + SUBSTRING('${formattedEndDate}', 4, 2) + '-' + SUBSTRING('${formattedEndDate}', 1, 2) + ' ' + SUBSTRING('${formattedEndDate}', 12, 8)))
                    GROUP BY Equipamento ORDER BY Equipamento ;`);
                temposMTTO = mediaMTTO.map(item => item.MTTO);
            }

            var dataMap = {};
    
            equipamentos.forEach(equip => {
                dataMap[equip] = 0; // Inicializa com 0 ou valor padrão desejado
            });
            
            mediaMTTO.forEach(item => {
                dataMap[item.Equipamento] = item.MTTO;
            });
            
            temposMTTO = equipamentos.map(equip => dataMap[equip]);

            mttoChart = new Chart(ctxMTTO, {
                type: 'bar',
                data: {
                    labels: equipamentos,
                    datasets: [{
                        label: 'Tempo Médio de Operação (MTTO)',
                        data: temposMTTO,
                        backgroundColor: 'rgba(255, 99, 132, 0.5)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                }
            });
        }

        function renderChartMTTMP(data, formattedStartDate, formattedEndDate, temData) {
            const ctxMTTMP = document.getElementById('chartMTTMP').getContext('2d');
            var equipmentTypes = data == 0 ? alasql('SELECT DISTINCT Equipamento FROM eventos ORDER BY Equipamento;') : alasql(`SELECT DISTINCT Equipamento FROM eventos where Equipamento == '${data}' ORDER BY Equipamento;`)
            let equipamentos = equipmentTypes.map(item => item.Equipamento);
            let mediaMTTMP;
            let temposMTTMP
            if(!temData)
            {
                mediaMTTMP = data == 0 ? alasql("SELECT Equipamento, AVG(DATEDIFF(HOUR, InicioEvento, FimEvento)) AS MTTMP FROM eventos WHERE CodEvento = '241' GROUP BY Equipamento ORDER BY Equipamento;") :
                alasql(`SELECT Equipamento, AVG(DATEDIFF(HOUR, InicioEvento, FimEvento)) AS MTTMP FROM eventos WHERE CodEvento = '241' AND Equipamento == '${data}' GROUP BY Equipamento ORDER BY Equipamento;`);
                temposMTTMP = mediaMTTMP.map(item => item.MTTMP);
            }else
            {
                mediaMTTMP = data == 0 ? alasql(`SELECT Equipamento, AVG(DATEDIFF(HOUR, InicioEvento, FimEvento)) AS MTTMP 
                FROM eventos 
                WHERE CodEvento = '241' 
                AND DATE(CONVERT(datetime, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2) + ' ' + SUBSTRING(InicioEvento, 12, 8))) >= DATE(CONVERT(datetime, SUBSTRING('${formattedStartDate}', 7, 4) + '-' + SUBSTRING('${formattedStartDate}', 4, 2) + '-' + SUBSTRING('${formattedStartDate}', 1, 2) + ' ' + SUBSTRING('${formattedStartDate}', 12, 8)))
                AND DATE(CONVERT(datetime, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2) + ' ' + SUBSTRING(FimEvento, 12, 8))) <= DATE(CONVERT(datetime, SUBSTRING('${formattedEndDate}', 7, 4) + '-' + SUBSTRING('${formattedEndDate}', 4, 2) + '-' + SUBSTRING('${formattedEndDate}', 1, 2) + ' ' + SUBSTRING('${formattedEndDate}', 12, 8)))
                GROUP BY Equipamento ORDER BY Equipamento;`)
                 :
                alasql(`SELECT Equipamento, AVG(DATEDIFF(HOUR, InicioEvento, FimEvento)) AS MTTMP
                 FROM eventos 
                 WHERE CodEvento = '241' AND Equipamento == '${data}' 
                AND DATE(CONVERT(datetime, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2) + ' ' + SUBSTRING(InicioEvento, 12, 8))) >= DATE(CONVERT(datetime, SUBSTRING('${formattedStartDate}', 7, 4) + '-' + SUBSTRING('${formattedStartDate}', 4, 2) + '-' + SUBSTRING('${formattedStartDate}', 1, 2) + ' ' + SUBSTRING('${formattedStartDate}', 12, 8)))
                AND DATE(CONVERT(datetime, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2) + ' ' + SUBSTRING(FimEvento, 12, 8))) <= DATE(CONVERT(datetime, SUBSTRING('${formattedEndDate}', 7, 4) + '-' + SUBSTRING('${formattedEndDate}', 4, 2) + '-' + SUBSTRING('${formattedEndDate}', 1, 2) + ' ' + SUBSTRING('${formattedEndDate}', 12, 8)))
                GROUP BY Equipamento ORDER BY Equipamento;`);
                temposMTTMP = mediaMTTMP.map(item => item.MTTMP);
            }

            var dataMap = {};
    
            equipamentos.forEach(equip => {
                dataMap[equip] = 0; 
            });
            
            mediaMTTMP.forEach(item => {
                dataMap[item.Equipamento] = item.MTTMP;
            });
            
            temposMTTMP = equipamentos.map(equip => dataMap[equip]);

            mttpmChart = new Chart(ctxMTTMP, {
                type: 'bar',
                data: {
                    labels: equipamentos,
                    datasets: [{
                        label: 'Tempo Médio de Manutenção Preventiva (MTTMP)',
                        data: temposMTTMP,
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                }
            });
        }

        function renderChartMTTQE(data, formattedStartDate, formattedEndDate, temData) {
            const ctxMTTQE = document.getElementById('chartMTTQE').getContext('2d');
            var equipmentTypes = data == 0 ? alasql('SELECT DISTINCT Equipamento FROM eventos ORDER BY Equipamento;') : alasql(`SELECT DISTINCT Equipamento FROM eventos where Equipamento == '${data}' ORDER BY Equipamento;`)
            let equipamentos = equipmentTypes.map(item => item.Equipamento);
            let temposMTTQE;
            let mediaMTTQE;
            if(!temData)
            {
                mediaMTTQE = data == 0 ? alasql("SELECT Equipamento, AVG(DATEDIFF(HOUR, InicioEvento, FimEvento)) AS MediaTempoEntreEventos FROM eventos WHERE CodEvento = '414' AND FimEvento IS NOT NULL GROUP BY Equipamento ORDER BY Equipamento; ") :
                alasql(`SELECT Equipamento, AVG(DATEDIFF(HOUR, InicioEvento, FimEvento)) AS MediaTempoEntreEventos FROM eventos WHERE CodEvento = '414'  AND Equipamento == '${data}' AND FimEvento IS NOT NULL GROUP BY Equipamento ORDER BY Equipamento;`);
                temposMTTQE = mediaMTTQE.map(item => item.MediaTempoEntreEventos);
            }
            else
            {
                mediaMTTQE = data == 0 ? alasql(`SELECT Equipamento, AVG(DATEDIFF(HOUR, InicioEvento, FimEvento)) AS MediaTempoEntreEventos 
                FROM eventos WHERE CodEvento = '414'  
                AND DATE(CONVERT(datetime, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2) + ' ' + SUBSTRING(InicioEvento, 12, 8))) >= DATE(CONVERT(datetime, SUBSTRING('${formattedStartDate}', 7, 4) + '-' + SUBSTRING('${formattedStartDate}', 4, 2) + '-' + SUBSTRING('${formattedStartDate}', 1, 2) + ' ' + SUBSTRING('${formattedStartDate}', 12, 8)))
                AND DATE(CONVERT(datetime, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2) + ' ' + SUBSTRING(FimEvento, 12, 8))) <= DATE(CONVERT(datetime, SUBSTRING('${formattedEndDate}', 7, 4) + '-' + SUBSTRING('${formattedEndDate}', 4, 2) + '-' + SUBSTRING('${formattedEndDate}', 1, 2) + ' ' + SUBSTRING('${formattedEndDate}', 12, 8)))
                GROUP BY Equipamento ORDER BY Equipamento; `) :
                alasql(`SELECT Equipamento, AVG(DATEDIFF(HOUR, InicioEvento, FimEvento)) AS MediaTempoEntreEventos 
                FROM eventos WHERE CodEvento = '414'  AND Equipamento == '${data}' AND FimEvento IS NOT NULL
                AND DATE(CONVERT(datetime, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2) + ' ' + SUBSTRING(InicioEvento, 12, 8))) >= DATE(CONVERT(datetime, SUBSTRING('${formattedStartDate}', 7, 4) + '-' + SUBSTRING('${formattedStartDate}', 4, 2) + '-' + SUBSTRING('${formattedStartDate}', 1, 2) + ' ' + SUBSTRING('${formattedStartDate}', 12, 8)))
                AND DATE(CONVERT(datetime, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2) + ' ' + SUBSTRING(FimEvento, 12, 8))) <= DATE(CONVERT(datetime, SUBSTRING('${formattedEndDate}', 7, 4) + '-' + SUBSTRING('${formattedEndDate}', 4, 2) + '-' + SUBSTRING('${formattedEndDate}', 1, 2) + ' ' + SUBSTRING('${formattedEndDate}', 12, 8)))
                GROUP BY Equipamento ORDER BY Equipamento;`);
                temposMTTQE = mediaMTTQE.map(item => item.MediaTempoEntreEventos);
            }

            var dataMap = {};
    
            equipamentos.forEach(equip => {
                dataMap[equip] = 0; 
            });
            
            mediaMTTQE.forEach(item => {
                dataMap[item.Equipamento] = item.MediaTempoEntreEventos;
            });
            
            temposMTTQE = equipamentos.map(equip => dataMap[equip]);

            mttqeChart = new Chart(ctxMTTQE, {
                type: 'bar',
                data: {
                    labels: equipamentos,
                    datasets: [{
                        label: 'Tempo Médio de Quebra de Equipamento (MTTQE)',
                        data: temposMTTQE,
                        backgroundColor: 'rgba(255, 206, 86, 0.5)',
                        borderColor: 'rgba(255, 206, 86, 1)',
                        borderWidth: 1
                    }]
                }
            });
        }

        function renderFalhasAtivas(data, formattedStartDate, formattedEndDate, temData) {
            const ctxMTTQE = document.getElementById('chartFalhasAtivas').getContext('2d');
            var equipmentTypes = data == 0 ? alasql('SELECT DISTINCT Equipamento FROM eventos ORDER BY Equipamento;') : alasql(`SELECT DISTINCT Equipamento FROM eventos where Equipamento == '${data}' ORDER BY Equipamento;`)
            let equipamentos = equipmentTypes.map(item => item.Equipamento);
            let tempoDias;
            let media;
        
            media = data == 0 ? alasql(`Select Equipamento,   ROUND(DATEDIFF(day, DATE(CONVERT(datetime, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2) + ' ' + SUBSTRING(InicioEvento, 12, 8))), DATE(now()))) as DATA, 
            InicioEvento
            from eventos
            where FimEvento is null and CodEvento = '414'`) :
            alasql(`Select Equipamento,  
            ROUND(DATEDIFF(day, DATE(CONVERT(datetime, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2) + ' ' + SUBSTRING(InicioEvento, 12, 8))), DATE(now()))) as DATA, InicioEvento
            from eventos
            where FimEvento is null and CodEvento = '414' AND Equipamento == '${data}'  
            ORDER BY Equipamento`);
            tempoDias = media.map(item => item.DATA);


            var dataMap = {};
    
            equipamentos.forEach(equip => {
                dataMap[equip] = 0; 
            });
            
            media.forEach(item => {
                dataMap[item.Equipamento] = item.DATA;
            });
            
            tempoDias = equipamentos.map(equip => dataMap[equip]);

            console.log('datas', media, tempoDias)

            ChartfalhasAtivas = new Chart(ctxMTTQE, {
                type: 'bar',
                data: {
                    labels: equipamentos,
                    datasets: [{
                        label: 'Taxa de Dias Equipamentos Com falhas Ativas',
                        data: tempoDias,
                        backgroundColor: 'rgba(184, 0, 0, 0.8)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                }
            });
        }

        function renderChartFailurePerDays(data, formattedStartDate, formattedEndDate, temData) {
            const ctxAvailability = document.getElementById('chartAvailability').getContext('2d');
            var equipmentTypes = data == 0 ? alasql('SELECT DISTINCT Equipamento FROM eventos ORDER BY Equipamento;') : alasql(`SELECT DISTINCT Equipamento FROM eventos where Equipamento == '${data}' ORDER BY Equipamento;`)
            let equipamentos = equipmentTypes.map(item => item.Equipamento);
            let temposAvailability;
            let taxaDias;

            if(!temData){
                var mediaAvailability = data == 0 ?
                alasql(`
                SELECT 
                    Equipamento,
                    COUNT(*) AS QuantidadeFalhas,
                    DATEDIFF(day, MIN(CONVERT(DATE, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2))), MAX(CONVERT(DATE, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2)))) AS DiasMonitoramento,
                      ROUND(COUNT(*) * 100.0 / NULLIF(DATEDIFF(day, MIN(CONVERT(DATE, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2))), MAX(CONVERT(DATE, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2)))), 0)) AS TaxaFalhaPorDia
                FROM eventos
                WHERE CodEvento = '414' AND FimEvento IS NOT NULL
                GROUP BY Equipamento
                ORDER BY Equipamento
            `) :
                alasql(`
                SELECT 
                    Equipamento,
                    COUNT(*) AS QuantidadeFalhas,
                    DATEDIFF(day, MIN(CONVERT(DATE, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2))), MAX(CONVERT(DATE, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2)))) AS DiasMonitoramento,
                      ROUND(COUNT(*) * 100.0 / NULLIF(DATEDIFF(day, MIN(CONVERT(DATE, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2))), MAX(CONVERT(DATE, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2)))), 0)) AS TaxaFalhaPorDia
                FROM eventos
                WHERE CodEvento = '414' AND FimEvento IS NOT NULL AND Equipamento == '${data}'
                GROUP BY Equipamento
                ORDER BY Equipamento
            `)
            temposAvailability = mediaAvailability.map(item => item.TaxaFalhaPorDia);
            taxaDias = mediaAvailability.map(item => item.TaxaFalhaPorDia);
            }
            else
            {
                var mediaAvailability = data == 0 ?
                alasql(`
                SELECT 
                    Equipamento,
                    COUNT(*) AS QuantidadeFalhas,
                    DATEDIFF(day, MIN(CONVERT(DATE, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2))), MAX(CONVERT(DATE, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2)))) AS DiasMonitoramento,
                      ROUND(COUNT(*) * 100.0 / NULLIF(DATEDIFF(day, MIN(CONVERT(DATE, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2))), MAX(CONVERT(DATE, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2)))), 0)) AS TaxaFalhaPorDia
                FROM eventos
                WHERE CodEvento = '414' AND FimEvento IS NOT NULL
                AND DATE(CONVERT(datetime, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2) + ' ' + SUBSTRING(InicioEvento, 12, 8))) >= DATE(CONVERT(datetime, SUBSTRING('${formattedStartDate}', 7, 4) + '-' + SUBSTRING('${formattedStartDate}', 4, 2) + '-' + SUBSTRING('${formattedStartDate}', 1, 2) + ' ' + SUBSTRING('${formattedStartDate}', 12, 8)))
                AND DATE(CONVERT(datetime, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2) + ' ' + SUBSTRING(FimEvento, 12, 8))) <= DATE(CONVERT(datetime, SUBSTRING('${formattedEndDate}', 7, 4) + '-' + SUBSTRING('${formattedEndDate}', 4, 2) + '-' + SUBSTRING('${formattedEndDate}', 1, 2) + ' ' + SUBSTRING('${formattedEndDate}', 12, 8)))
                GROUP BY Equipamento
                ORDER BY Equipamento
            `) :
                alasql(`
                    SELECT 
                        Equipamento,
                        COUNT(*) AS QuantidadeFalhas,
                        DATEDIFF(day, MIN(CONVERT(DATE, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2))), MAX(CONVERT(DATE, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2)))) AS DiasMonitoramento,
                        ROUND(COUNT(*) * 100.0 / NULLIF(DATEDIFF(day, MIN(CONVERT(DATE, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2))), MAX(CONVERT(DATE, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2)))), 0)) AS TaxaFalhaPorDia
                    FROM eventos
                    WHERE CodEvento = '414' AND FimEvento IS NOT NULL AND Equipamento == '${data}'
                    AND DATE(CONVERT(datetime, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2) + ' ' + SUBSTRING(InicioEvento, 12, 8))) >= DATE(CONVERT(datetime, SUBSTRING('${formattedStartDate}', 7, 4) + '-' + SUBSTRING('${formattedStartDate}', 4, 2) + '-' + SUBSTRING('${formattedStartDate}', 1, 2) + ' ' + SUBSTRING('${formattedStartDate}', 12, 8)))
                    AND DATE(CONVERT(datetime, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2) + ' ' + SUBSTRING(FimEvento, 12, 8))) <= DATE(CONVERT(datetime, SUBSTRING('${formattedEndDate}', 7, 4) + '-' + SUBSTRING('${formattedEndDate}', 4, 2) + '-' + SUBSTRING('${formattedEndDate}', 1, 2) + ' ' + SUBSTRING('${formattedEndDate}', 12, 8)))
                    GROUP BY Equipamento
                    ORDER BY Equipamento
                `)
                temposAvailability = mediaAvailability.map(item => item.TaxaFalhaPorDia);
                taxaDias = mediaAvailability.map(item => item.TaxaFalhaPorDia);
            }


            var dataMap = {};
    
            equipamentos.forEach(equip => {
                dataMap[equip] = 0; 
            });
            
            mediaAvailability.forEach(item => {
                dataMap[item.Equipamento] = item.TaxaFalhaPorDia;
            });
            
            temposAvailability = equipamentos.map(equip => dataMap[equip]);

            console.log('media MTTO', mediaAvailability, temposAvailability)

            console.log('falhas por dia', mediaAvailability)
            availabilityChart = new Chart(ctxAvailability, {
                type: 'bar',
                data: {
                    labels: equipamentos,
                    datasets: [{
                        label: 'Taxa de Falhas por Dia (%)',
                        data: temposAvailability,
                        backgroundColor: 'rgba(78, 355, 192, 0.5)',
                        borderColor: 'rgba(75, 355, 192, 1)',
                        borderWidth: 1
                    }]
                }
            });
        }

        function renderChartTaxaDisponibilidade(data, formattedStartDate, formattedEndDate, temData) {
            const TaxaDisponibilidadePercentual = document.getElementById('chartTaxaDisponibilidadePercentual').getContext('2d');
            var equipmentTypes = data == 0 ? alasql('SELECT DISTINCT Equipamento FROM eventos ORDER BY Equipamento;') : alasql(`SELECT DISTINCT Equipamento FROM eventos where Equipamento == '${data}' ORDER BY Equipamento;`)
            let equipamentos = equipmentTypes.map(item => item.Equipamento);
            let mediaAvailability ;
            let temposAvailability;

            if(!temData){
                mediaAvailability = data == 0 ? alasql("SELECT Equipamento, ROUND((SUM(CASE WHEN CodEvento = '264' THEN DATEDIFF(HOUR, InicioEvento, FimEvento) ELSE 0 END) /  SUM(DATEDIFF(HOUR, InicioEvento, FimEvento))) * 100) AS Disponibilidade FROM  eventos GROUP BY  Equipamento ORDER BY Equipamento; ") :
                alasql(`SELECT Equipamento, ROUND((SUM(CASE WHEN CodEvento = '264' THEN DATEDIFF(HOUR, InicioEvento, FimEvento) ELSE 0 END) /  SUM(DATEDIFF(HOUR, InicioEvento, FimEvento))) * 100) AS Disponibilidade FROM  eventos where Equipamento == '${data}' GROUP BY Equipamento ORDER BY Equipamento;; `);
                temposAvailability = mediaAvailability.map(item => item.Disponibilidade);
            }
            else
            {
                mediaAvailability = data == 0 ? alasql(`SELECT Equipamento, ROUND((SUM(CASE WHEN CodEvento = '264' THEN DATEDIFF(HOUR, InicioEvento, FimEvento) ELSE 0 END) /  SUM(DATEDIFF(HOUR, InicioEvento, FimEvento))) * 100) AS Disponibilidade 
                FROM  eventos 
                WHERE DATE(CONVERT(datetime, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2) + ' ' + SUBSTRING(InicioEvento, 12, 8))) >= DATE(CONVERT(datetime, SUBSTRING('${formattedStartDate}', 7, 4) + '-' + SUBSTRING('${formattedStartDate}', 4, 2) + '-' + SUBSTRING('${formattedStartDate}', 1, 2) + ' ' + SUBSTRING('${formattedStartDate}', 12, 8)))
                AND DATE(CONVERT(datetime, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2) + ' ' + SUBSTRING(FimEvento, 12, 8))) <= DATE(CONVERT(datetime, SUBSTRING('${formattedEndDate}', 7, 4) + '-' + SUBSTRING('${formattedEndDate}', 4, 2) + '-' + SUBSTRING('${formattedEndDate}', 1, 2) + ' ' + SUBSTRING('${formattedEndDate}', 12, 8)))
                GROUP BY  Equipamento ORDER BY Equipamento; `) :
                alasql(`SELECT Equipamento, ROUND((SUM(CASE WHEN CodEvento = '264' THEN DATEDIFF(HOUR, InicioEvento, FimEvento) ELSE 0 END) /  SUM(DATEDIFF(HOUR, InicioEvento, FimEvento))) * 100) AS Disponibilidade 
                FROM  eventos 
                where Equipamento == '${data}'
                AND DATE(CONVERT(datetime, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2) + ' ' + SUBSTRING(InicioEvento, 12, 8))) >= DATE(CONVERT(datetime, SUBSTRING('${formattedStartDate}', 7, 4) + '-' + SUBSTRING('${formattedStartDate}', 4, 2) + '-' + SUBSTRING('${formattedStartDate}', 1, 2) + ' ' + SUBSTRING('${formattedStartDate}', 12, 8)))
                AND DATE(CONVERT(datetime, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2) + ' ' + SUBSTRING(FimEvento, 12, 8))) <= DATE(CONVERT(datetime, SUBSTRING('${formattedEndDate}', 7, 4) + '-' + SUBSTRING('${formattedEndDate}', 4, 2) + '-' + SUBSTRING('${formattedEndDate}', 1, 2) + ' ' + SUBSTRING('${formattedEndDate}', 12, 8)))
                GROUP BY Equipamento ORDER BY Equipamento;; `);
                temposAvailability = mediaAvailability.map(item => item.Disponibilidade);
            }

            var dataMap = {};
    
            equipamentos.forEach(equip => {
                dataMap[equip] = 0; 
            });
            
            mediaAvailability.forEach(item => {
                dataMap[item.Equipamento] = item.Disponibilidade;
            });
            
            temposAvailability = equipamentos.map(equip => dataMap[equip]);

            chartTaxaDisponibilidadePercentual = new Chart(TaxaDisponibilidadePercentual, {
                type: 'bar',
                data: {
                    labels: equipamentos,
                    datasets: [{
                        label: 'Taxa de Disponibilidade (%) ',
                        data: temposAvailability,
                        backgroundColor: 'rgba(75, 192, 192, 0.5)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    tooltips: {
                        callbacks: {
                            label: function (tooltipItem, data) {
                                const equipamento = data.labels[tooltipItem.index];
                                const taxaDisponibilidade = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                                const diasMonitoramento = totalDaysData[tooltipItem.index];
                                return `${equipamento}: ${taxaDisponibilidade.toFixed(2)}% (Dias: ${diasMonitoramento.toFixed(2)})`;
                            }
                        }
                    }
                }
            });
        }


        function renderNumberBreakdowns(data, formattedStartDate, formattedEndDate, temData) {
            const numberBreakdowns = document.getElementById('numberBreakdowns');
            if(!temData)
            {
                var total = data == 0 ? alasql("SELECT SUM(NumeroDeQuebras) AS TotalQuebras FROM (    SELECT Equipamento, COUNT(*) AS NumeroDeQuebras FROM eventos WHERE CodEvento = '414' and FimEvento IS NOT NULL   GROUP BY Equipamento) AS Subquery;") :
                alasql(`SELECT Equipamento, COUNT(*) AS NumeroDeQuebras FROM eventos WHERE CodEvento = '414' AND Equipamento == '${data}' AND  FimEvento IS NOT NULL GROUP BY Equipamento`)
                numberBreakdowns.textContent = data == 0 ? total[0].TotalQuebras : total[0].NumeroDeQuebras;
            }else{
                var total = data == 0 ? alasql(`
                SELECT SUM(NumeroDeQuebras) AS TotalQuebras
                FROM (    SELECT Equipamento, COUNT(*) AS NumeroDeQuebras FROM eventos WHERE CodEvento = '414'
                AND FimEvento IS NOT NULL 
                AND DATE(CONVERT(datetime, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2) + ' ' + SUBSTRING(InicioEvento, 12, 8))) >= DATE(CONVERT(datetime, SUBSTRING('${formattedStartDate}', 7, 4) + '-' + SUBSTRING('${formattedStartDate}', 4, 2) + '-' + SUBSTRING('${formattedStartDate}', 1, 2) + ' ' + SUBSTRING('${formattedStartDate}', 12, 8)))
                AND DATE(CONVERT(datetime, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2) + ' ' + SUBSTRING(FimEvento, 12, 8))) <= DATE(CONVERT(datetime, SUBSTRING('${formattedEndDate}', 7, 4) + '-' + SUBSTRING('${formattedEndDate}', 4, 2) + '-' + SUBSTRING('${formattedEndDate}', 1, 2) + ' ' + SUBSTRING('${formattedEndDate}', 12, 8)))
                GROUP BY Equipamento) AS Subquery;
                `) 
                :
                alasql(`
                SELECT Equipamento, COUNT(*) AS NumeroDeQuebras
                 FROM eventos WHERE CodEvento = '414' 
                 AND Equipamento == '${data}'  AND FimEvento IS NOT NULL             
                 AND DATE(CONVERT(datetime, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2) + ' ' + SUBSTRING(InicioEvento, 12, 8))) >= DATE(CONVERT(datetime, SUBSTRING('${formattedStartDate}', 7, 4) + '-' + SUBSTRING('${formattedStartDate}', 4, 2) + '-' + SUBSTRING('${formattedStartDate}', 1, 2) + ' ' + SUBSTRING('${formattedStartDate}', 12, 8)))
                 AND DATE(CONVERT(datetime, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2) + ' ' + SUBSTRING(FimEvento, 12, 8))) <= DATE(CONVERT(datetime, SUBSTRING('${formattedEndDate}', 7, 4) + '-' + SUBSTRING('${formattedEndDate}', 4, 2) + '-' + SUBSTRING('${formattedEndDate}', 1, 2) + ' ' + SUBSTRING('${formattedEndDate}', 12, 8)))
                 GROUP BY Equipamento
                `)
                console.log('tot', total)
                numberBreakdowns.textContent = data == 0 ? total[0].TotalQuebras : total.length > 0 ? total[0].NumeroDeQuebras : 0
            }

           
        }

        function renderNumberPreventiveMaintenances(data, formattedStartDate, formattedEndDate, temData) {
            const numberPreventiveMaintenances = document.getElementById('numberPreventiveMaintenances');
            if(!temData)
            {
                var total = data == 0 ? alasql(`
                SELECT SUM(NumeroDeManutencoesPreventivas) AS TotalManutencoesPreventivas FROM ( SELECT COUNT(*) AS NumeroDeManutencoesPreventivas FROM eventos WHERE CodEvento = '241'  GROUP BY Equipamento) AS Subquery;
                `) :
                alasql(`
                SELECT COUNT(*) AS NumeroDeManutencoesPreventivas FROM eventos 
                WHERE CodEvento = '241' AND Equipamento == '${data}' GROUP BY Equipamento;`)
                numberPreventiveMaintenances.textContent = data == 0 ? total[0].TotalManutencoesPreventivas :  total.length > 0 ? total[0].NumeroDeManutencoesPreventivas : 0
            }else{
                var total = data == 0 ? alasql(`
                SELECT SUM(NumeroDeManutencoesPreventivas) AS TotalManutencoesPreventivas FROM ( SELECT COUNT(*) AS NumeroDeManutencoesPreventivas FROM eventos WHERE CodEvento = '241'  
                 AND DATE(CONVERT(datetime, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2) + ' ' + SUBSTRING(InicioEvento, 12, 8))) >= DATE(CONVERT(datetime, SUBSTRING('${formattedStartDate}', 7, 4) + '-' + SUBSTRING('${formattedStartDate}', 4, 2) + '-' + SUBSTRING('${formattedStartDate}', 1, 2) + ' ' + SUBSTRING('${formattedStartDate}', 12, 8)))
                AND DATE(CONVERT(datetime, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2) + ' ' + SUBSTRING(FimEvento, 12, 8))) <= DATE(CONVERT(datetime, SUBSTRING('${formattedEndDate}', 7, 4) + '-' + SUBSTRING('${formattedEndDate}', 4, 2) + '-' + SUBSTRING('${formattedEndDate}', 1, 2) + ' ' + SUBSTRING('${formattedEndDate}', 12, 8)))
                GROUP BY Equipamento) AS Subquery;
                `) :
                alasql(`
                SELECT COUNT(*) AS NumeroDeManutencoesPreventivas FROM eventos 
                WHERE CodEvento = '241' AND Equipamento == '${data}'
                AND DATE(CONVERT(datetime, SUBSTRING(InicioEvento, 7, 4) + '-' + SUBSTRING(InicioEvento, 4, 2) + '-' + SUBSTRING(InicioEvento, 1, 2) + ' ' + SUBSTRING(InicioEvento, 12, 8))) >= DATE(CONVERT(datetime, SUBSTRING('${formattedStartDate}', 7, 4) + '-' + SUBSTRING('${formattedStartDate}', 4, 2) + '-' + SUBSTRING('${formattedStartDate}', 1, 2) + ' ' + SUBSTRING('${formattedStartDate}', 12, 8)))
                AND DATE(CONVERT(datetime, SUBSTRING(FimEvento, 7, 4) + '-' + SUBSTRING(FimEvento, 4, 2) + '-' + SUBSTRING(FimEvento, 1, 2) + ' ' + SUBSTRING(FimEvento, 12, 8))) <= DATE(CONVERT(datetime, SUBSTRING('${formattedEndDate}', 7, 4) + '-' + SUBSTRING('${formattedEndDate}', 4, 2) + '-' + SUBSTRING('${formattedEndDate}', 1, 2) + ' ' + SUBSTRING('${formattedEndDate}', 12, 8)))
                GROUP BY Equipamento;`)
               
                numberPreventiveMaintenances.textContent = data == 0 ? total[0].TotalManutencoesPreventivas : total.length > 0 ? total[0].NumeroDeManutencoesPreventivas : 0
            }

        }

        function renderTotalEquipment(data) {
            const totalEquipment = document.getElementById('totalEquipment');
            var total = alasql("SELECT COUNT(DISTINCT Equipamento) AS TotalEquipamentos FROM eventos;")
            totalEquipment.textContent = total[0].TotalEquipamentos;
        }

        function adjustDate(date, endOfDay = false) {
            let d = new Date(date + 'T00:00:00'); // Ajusta a data para o início do dia
            if (endOfDay) {
                d.setHours(23, 59, 59); // Ajusta a hora para o final do dia
            }
            let day = ("0" + d.getDate()).slice(-2);
            let month = ("0" + (d.getMonth() + 1)).slice(-2);
            let year = d.getFullYear();
            let time = endOfDay ? '23:59:59' : '00:00:00';

            return `${day}/${month}/${year} ${time}`;
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('btnFiltrar').addEventListener('click', function () {
                var startDateValue = document.getElementById('startDate').value;
                var endDateValue = document.getElementById('endDate').value;
                const selectEquipment = document.getElementById('selectEquipment');
                const selectedEquipment = selectEquipment.value;
                console.log('Data limpa:', startDateValue, endDateValue);
                if (startDateValue != "" && endDateValue != "") {
                    var formattedStartDate = adjustDate(startDateValue);
                    var formattedEndDate = adjustDate(endDateValue, true);

                    console.log('Data de Início selecionada:', formattedStartDate);
                    console.log('Data Final selecionada:', formattedEndDate);
                   
                    destroyCharts();
                    renderMetrics(selectedEquipment, formattedStartDate, formattedEndDate, true);
                }else{
                    destroyCharts();
                    renderMetrics(selectedEquipment, "", "", false);
                }

            });
        });

    </script>
</head>

<body onload="loadData()">
    <div class="container mt-5">
        <h1 class="mb-4">Painel de Indicadores</h1>
        <div class="row">
            <div class="col-md-3">
                <div class="form-group">
                    <label for="selectEquipment">Selecione o Equipamento:</label>
                    <select id="selectEquipment" class="form-control">
                    </select>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label for="startDate">Data de Início:</label>
                    <input type="date" id="startDate" class="form-control">
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label for="endDate">Data Final:</label>
                    <input type="date" id="endDate" class="form-control">
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <button class="btn btn-primary mt-4" id="btnFiltrar">Filtrar</button>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Total de Equipamentos</h5>
                        <p class="card-text" id="totalEquipment">-</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Número Total de Falhas (Corrigidas)</h5>
                        <p class="card-text" id="numberBreakdowns">-</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Número Total de Manutenções Preventivas</h5>
                        <p class="card-text" id="numberPreventiveMaintenances">-</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Tempo Médio de Operação (MTTO)</h5>
                        <canvas id="chartMTTO" height="150"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Tempo Médio de Manutenção Preventiva (MTTMP)</h5>
                        <canvas id="chartMTTMP" height="150"></canvas>
                    </div>
                </div>
            </div>

        </div>
        <div class="row mt-4">

            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Tempo Médio de Quebra de Equipamento (MTTQE)</h5>
                        <canvas id="chartMTTQE" height="150"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Taxa de Disponibilidade</h5>
                        <canvas id="chartTaxaDisponibilidadePercentual" height="150"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-4">

            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 id="taxaFalhasPorDia" class="card-title">Taxa de Falhas por Dia (%) <span
                                id="valorTaxaFalhas"></span></h5>
                        <canvas id="chartAvailability" height="150"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 id="taxaFalhasPorDia" class="card-title">Taxa de Dias Equipamentos Com falhas Ativas<span
                                id="FalhasAtivas"></span></h5>
                        <canvas id="chartFalhasAtivas" height="150"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>

</html>